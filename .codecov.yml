# ğŸ“Š GoVel Framework - Codecov Configuration
#
# This configuration defines code coverage reporting and quality gates
# for the GoVel framework. It ensures high-quality code through
# comprehensive coverage analysis and automated quality checks.
#
# Features:
# - ğŸ“ˆ Coverage thresholds and quality gates
# - ğŸ“¦ Per-package coverage requirements
# - ğŸ¯ Pull request status checks
# - ğŸ“Š Coverage trend analysis
# - ğŸš« Proper path ignoring for generated/test files
#
# Documentation: https://docs.codecov.io/docs/codecov-yaml
# Author: GoVel Framework Team
# Version: 1.0.0

# ğŸ¯ Coverage configuration
coverage:
  # ğŸ“Š Precision for coverage percentage (2 decimal places)
  precision: 2
  
  # ğŸ¯ Rounding mode: down, up, nearest
  round: nearest
  
  # ğŸ“ˆ Coverage range for color coding (red to green)
  range: "60...90"
  
  # ğŸ“‹ Status checks configuration
  status:
    # ğŸ” Project-wide coverage requirements
    project:
      default:
        # ğŸ¯ Target coverage percentage
        target: 80%
        
        # ğŸ“‰ Allowed coverage drop threshold
        threshold: 2%
        
        # ğŸ“Š Base for comparison (auto, parent, pr)
        base: auto
        
        # ğŸš« Only post status if coverage changes
        if_no_uploads: error
        
        # ğŸ›ï¸ Only run on these branches
        branches:
          - main
          - develop
          
        # ğŸ“¦ Path-based coverage (focus on source code)
        paths:
          - "packages/*/src"
          - "packages/*/*.go"
        
    # ğŸ”„ Patch coverage (new code in PRs)
    patch:
      default:
        # ğŸ¯ New code must be well tested
        target: 85%
        
        # ğŸ“‰ Strict threshold for new code
        threshold: 3%
        
        # ğŸ“Š Base comparison
        base: auto
        
        # ğŸ” Only analyze changed files
        only_pulls: true
        
        # ğŸ“¦ Focus on source code changes
        paths:
          - "packages/*/src"
          - "packages/*/*.go"

  # ğŸ“‹ Individual package coverage requirements
  flags:
    # ğŸ” Core packages require higher coverage
    core-packages:
      paths:
        - packages/application
        - packages/container  
        - packages/config
        - packages/logger
      target: 85%
      
    # ğŸ›¡ï¸ Security-critical packages
    security-packages:
      paths:
        - packages/encryption
        - packages/hashing
      target: 90%
      
    # ğŸ”§ Utility packages
    utility-packages:
      paths:
        - packages/support
        - packages/cookie
        - packages/pipeline
      target: 80%

# ğŸ’¬ Comment configuration for pull requests
comment:
  # ğŸ“Š Layout of the coverage comment
  layout: "reach,diff,flags,tree,betaprofiling"
  
  # ğŸ¯ Behavior settings
  behavior: default
  
  # ğŸ“‰ Require coverage changes to post comment
  require_changes: true
  
  # ğŸ“ Show file-level coverage in comments
  require_base: no
  require_head: yes
  
  # ğŸ“‹ Branch settings for comments
  branches:
    - main
    - develop

# ğŸ“‚ Path ignoring configuration
ignore:
  # ğŸ§ª Test files and test utilities
  - "**/tests/**"
  - "**/test/**"
  - "**/*_test.go"
  - "**/mocks/**"
  - "**/mock_*.go"
  - "**/*_mock.go"
  
  # ğŸ“„ Documentation and examples
  - "**/docs/**"
  - "**/examples/**"
  - "**/demo/**"
  - "**/*.md"
  
  # ğŸ”§ Generated and vendor code
  - "**/vendor/**"
  - "**/*.pb.go"
  - "**/*.gen.go"
  - "**/generated/**"
  
  # ğŸ—ï¸ Build and tooling
  - "**/scripts/**"
  - "**/tools/**"
  - "**/build/**"
  - "**/dist/**"
  - "Makefile"
  - "**/*.yml"
  - "**/*.yaml"
  - "**/go.mod"
  - "**/go.sum"
  
  # ğŸ“¦ Package-specific ignores
  - "packages/new/**"          # New/experimental packages
  - "**/cmd/**"               # Command-line tools
  - "**/main.go"              # Main entry points

# ğŸš¨ Notification configuration
github_checks:
  # âœ… Enable GitHub status checks
  annotations: true

# ğŸ”§ Parsing configuration
parsers:
  go:
    # ğŸ“Š Go coverage report parsing
    branch_detection:
      conditional: true
      loop: true
      method: false
      macro: false
  
  gcov:
    # ğŸ¯ Branch coverage settings
    branch_detection:
      conditional: true
      loop: true
      method: false
      macro: false

# ğŸ“ˆ Profiling and analytics
profiling:
  # ğŸ” Critical files that need high attention
  critical_files_paths:
    - packages/application/application.go
    - packages/container/container.go
    - packages/encryption/src/*.go
    - packages/hashing/src/*.go
    - packages/logger/logger.go

# ğŸ›ï¸ Advanced configuration
codecov:
  # ğŸ”’ Security and validation
  require_ci_to_pass: true
  
  # ğŸ“Š Archive settings
  archive:
    uploads: true
    
  # ğŸ•’ Upload timeout
  max_report_age: 24  # hours
  
  # ğŸ“§ Notification settings
  notify:
    # ğŸ“¥ After N uploads
    after_n_builds: 2
    
    # â° Wait time before sending notifications  
    wait_for_ci: true

